<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>rad.typo admin</title>
  <style>
    /* CSS Variables for theming */
    :root {
      --bg-color: #fff;
      --text-color: #000;
      --accent-color: #666;
      --border-color: #ccc;
      --header-color: #efefef;
      --focus-color: #0056b3;
    }
    
    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #fff;
      --accent-color: #999;
      --border-color: #444;
      --header-color: #333;
      --focus-color: #5c9eff;
    }
    
    /* Base styles */
    body {
      font-family: monospace;
      background-color: var(--bg-color);
      color: var(--text-color);
      max-width: 90%;
      margin: 20px auto;
      padding: 20px;
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    /* Actions bar */
    .actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 10px;
      background-color: var(--header-color);
      border-radius: 4px;
    }
    
    /* Song list styles */
    .song-list {
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    
    .song-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .song-item:last-child {
      border-bottom: none;
    }
    
    .song-title {
      flex-grow: 1;
      margin-left: 10px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 0;
    }
    
    .tab {
      padding: 10px 15px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      margin-bottom: -1px;
      background-color: var(--bg-color);
    }
    
    .tab.active {
      border-color: var(--border-color);
      border-bottom-color: var(--bg-color);
      font-weight: bold;
    }
    
    /* Tab content */
    .tab-content {
      display: none;
      padding: 20px;
      border: 1px solid var(--border-color);
      border-top: none;
      border-radius: 0 0 4px 4px;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Form styles */
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    
    .form-col {
      flex: 1;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: monospace;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--focus-color);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    /* Buttons */
    button {
      padding: 8px 12px;
      background-color: var(--accent-color);
      color: var(--bg-color);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: monospace;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .button-group {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }
    
    /* Status indicators */
    .status {
      padding: 3px 6px;
      border-radius: 3px;
      font-size: 0.8em;
    }
    
    .status-released {
      background-color: #28a745;
      color: white;
    }
    
    .status-in-progress {
      background-color: #ffc107;
      color: black;
    }
    
    .status-archive {
      background-color: #6c757d;
      color: white;
    }
    
    /* Hide the song editor initially */
    #song-editor {
      display: none;
    }
    
    /* Modal for messages */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: var(--bg-color);
      padding: 20px;
      border-radius: 5px;
      width: 80%;
      max-width: 500px;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .close {
      font-size: 24px;
      cursor: pointer;
    }
    
    /* Loading indicator */
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    /* Media fields container */
    .media-fields {
      border: 1px solid var(--border-color);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 4px;
    }
    
    .media-type {
      font-weight: bold;
      margin-bottom: 10px;
    }

    /* No songs message */
    .no-songs {
      text-align: center;
      padding: 20px;
      color: var(--accent-color);
    }

    /* Error message */
    .error {
      color: #dc3545;
      margin-top: 5px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <header>
    <h1>rad.typo admin</h1>
    <button id="theme-toggle">dark mode</button>
  </header>
  
  <div class="actions">
    <div>
      <button id="add-song-btn">Add New Song</button>
      <button id="export-btn">Export JSON</button>
      <button id="import-btn">Import JSON</button>
    </div>
    <div id="song-count">0 songs</div>
  </div>
  
  <div id="song-list" class="song-list">
    <div class="no-songs">No songs found. Add a new song to get started.</div>
  </div>
  
  <div id="song-editor">
    <div class="tabs">
      <div class="tab active" data-tab="basic-info">Basic Info</div>
      <div class="tab" data-tab="media">Media</div>
      <div class="tab" data-tab="credits">Credits</div>
      <div class="tab" data-tab="context">Context</div>
      <div class="tab" data-tab="origin">Origin</div>
      <div class="tab" data-tab="content">Content</div>
      <div class="tab" data-tab="archival">Archival</div>
      <div class="tab" data-tab="technical">Technical</div>
    </div>
    
    <div id="basic-info" class="tab-content active">
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="title">Title*</label>
            <input type="text" id="title" required>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="slug">Slug*</label>
            <input type="text" id="slug" required>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="date">Date*</label>
            <input type="date" id="date" required>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="year">Year*</label>
            <input type="number" id="year" required min="1900" max="2100">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="duration">Duration*</label>
            <input type="text" id="duration" required placeholder="e.g. 3:43">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="status">Status*</label>
        <select id="status" required>
          <option value="released">Released</option>
          <option value="in-progress">In Progress</option>
          <option value="archive">Archive</option>
        </select>
      </div>
    </div>
    
    <div id="media" class="tab-content">
      <h3>Media Availability</h3>
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_mp3"> Has MP3
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_wav"> Has WAV
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_stems"> Has Stems
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_artwork"> Has Artwork
            </label>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_video_acoustic"> Has Acoustic Video
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_video_studio"> Has Studio Video
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_chords"> Has Chords
            </label>
          </div>
        </div>
      </div>
      
      <h3>Media Details</h3>
      
      <div id="mp3_fields" class="media-fields" style="display: none;">
        <div class="media-type">MP3 Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="mp3_url">MP3 URL</label>
              <input type="url" id="mp3_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="mp3_size">MP3 Size (MB)</label>
              <input type="number" id="mp3_size" step="0.1">
            </div>
          </div>
        </div>
      </div>
      
      <div id="wav_fields" class="media-fields" style="display: none;">
        <div class="media-type">WAV Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="wav_url">WAV URL</label>
              <input type="url" id="wav_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="wav_size">WAV Size (MB)</label>
              <input type="number" id="wav_size" step="0.1">
            </div>
          </div>
        </div>
      </div>
      
      <div id="stems_fields" class="media-fields" style="display: none;">
        <div class="media-type">Stems Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="stems_url">Stems URL</label>
              <input type="url" id="stems_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="stems_size">Stems Size (MB)</label>
              <input type="number" id="stems_size" step="0.1">
            </div>
          </div>
        </div>
      </div>
      
      <div id="artwork_fields" class="media-fields" style="display: none;">
        <div class="media-type">Artwork Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_url">Artwork URL</label>
              <input type="url" id="artwork_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_title">Artwork Title</label>
              <input type="text" id="artwork_title" placeholder="e.g. 'We'll be lucky if I don't bust out crying'">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_year">Artwork Year</label>
              <input type="number" id="artwork_year" min="1900" max="2100">
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_medium">Artwork Medium</label>
              <input type="text" id="artwork_medium" placeholder="e.g. 'Acrylic on canvas'">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_alt_text">Artwork Alt Text</label>
              <input type="text" id="artwork_alt_text" placeholder="Accessibility description">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Additional media fields would go here (video, chords, etc.) -->
    </div>
    
    <div id="credits" class="tab-content">
      <div class="form-group">
        <label for="composers">Composers (one per line with percentages)</label>
        <textarea id="composers" placeholder="Andrew Ferris (33%)&#10;Caolán Austin (33%)&#10;Chris Cassidy (33%)"></textarea>
      </div>
      
      <div class="form-group">
        <label for="performers">Performers (one per line with roles)</label>
        <textarea id="performers" placeholder="Andrew Ferris: Vocals, Guitar, Keyboard&#10;Caolán Austin: Drums, Percussion, Guitar&#10;Chris Cassidy: Bass"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="engineering">Engineering</label>
            <input type="text" id="engineering" placeholder="Who recorded">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="mixing">Mixing</label>
            <input type="text" id="mixing" placeholder="Who mixed">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="mastering">Mastering</label>
            <input type="text" id="mastering" placeholder="Who mastered">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="recording_location">Recording Location</label>
        <input type="text" id="recording_location" placeholder="Studio name, city, country">
      </div>
    </div>
    
    <div id="context" class="tab-content">
      <div class="form-group">
        <label for="tags">Tags (comma separated)</label>
        <input type="text" id="tags" placeholder="e.g. electronic, featured">
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="featured">Featured</label>
            <select id="featured">
              <option value="Yes">Yes</option>
              <option value="No" selected>No</option>
            </select>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="collection">Collection</label>
            <input type="text" id="collection" placeholder="Album/EP it belongs to">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="series">Series</label>
            <input type="text" id="series" placeholder="Thematic series">
          </div>
        </div>
      </div>
    </div>
    
    <div id="origin" class="tab-content">
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="location">Location</label>
            <input type="text" id="location" placeholder="City, Country">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="latitude">Latitude</label>
            <input type="number" id="latitude" step="0.0001" placeholder="e.g. 54.9966">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="longitude">Longitude</label>
            <input type="number" id="longitude" step="0.0001" placeholder="e.g. -7.3086">
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="date_recorded">Date Recorded</label>
            <input type="date" id="date_recorded">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="time_recorded">Time Recorded</label>
            <input type="time" id="time_recorded">
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="season">Season</label>
            <select id="season">
              <option value="">Select season</option>
              <option value="Imbolc">Imbolc</option>
              <option value="Beltane">Beltane</option>
              <option value="Lughnasadh">Lughnasadh</option>
              <option value="Samhain">Samhain</option>
            </select>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="moon_phase">Moon Phase</label>
            <select id="moon_phase">
              <option value="">Select moon phase</option>
              <option value="New Moon">New Moon</option>
              <option value="Waxing Crescent">Waxing Crescent</option>
              <option value="First Quarter">First Quarter</option>
              <option value="Waxing Gibbous">Waxing Gibbous</option>
              <option value="Full Moon">Full Moon</option>
              <option value="Waning Gibbous">Waning Gibbous</option>
              <option value="Last Quarter">Last Quarter</option>
              <option value="Waning Crescent">Waning Crescent</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="temperature">Temperature (°C)</label>
            <input type="number" id="temperature" step="0.1" placeholder="e.g. 7.3">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="weather_conditions">Weather Conditions</label>
            <input type="text" id="weather_conditions" placeholder="e.g. Light Rain">
          </div>
        </div>
      </div>
    </div>
    
    <div id="content" class="tab-content">
      <div class="form-group">
        <label for="lyrics">Lyrics</label>
        <textarea id="lyrics" rows="10" placeholder="Full song lyrics"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="public_notes">Public Notes</label>
            <textarea id="public_notes" placeholder="Notes to display on the site"></textarea>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="personal_notes">Personal Notes</label>
            <textarea id="personal_notes" placeholder="Private archival notes"></textarea>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="instrumentation">Instrumentation</label>
            <input type="text" id="instrumentation" placeholder="List of instruments used">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="key">Key</label>
            <input type="text" id="key" placeholder="Musical key">
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="bpm">BPM</label>
            <input type="number" id="bpm" placeholder="Tempo">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="chord_progression">Chord Progression</label>
            <input type="text" id="chord_progression" placeholder="e.g. Cm - Ab - Eb - Bb">
          </div>
        </div>
      </div>
    </div>
    
    <div id="archival" class="tab-content">
      <div class="form-group">
        <label for="story_behind">Story Behind</label>
        <textarea id="story_behind" placeholder="Creation narrative"></textarea>
      </div>
      
      <div class="form-group">
        <label for="inspiration">Inspiration</label>
        <textarea id="inspiration" placeholder="What inspired the work"></textarea>
      </div>
      
      <div class="form-group">
        <label for="development_history">Development History</label>
        <textarea id="development_history" placeholder="How the song evolved"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="alternative_titles">Alternative Titles</label>
            <input type="text" id="alternative_titles" placeholder="Working titles used">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="demo_versions">Demo Versions</label>
            <input type="url" id="demo_versions" placeholder="Links to earlier demos">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="future_release_notes">Future Release Notes</label>
        <textarea id="future_release_notes" placeholder="Instructions for posthumous/future release"></textarea>
      </div>
    </div>
    
    <div id="technical" class="tab-content">
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="recording_method">Recording Method</label>
            <input type="text" id="recording_method" placeholder="Analog/digital approach">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="equipment_used">Equipment Used</label>
            <input type="text" id="equipment_used" placeholder="Specific gear/equipment">
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="samples_used">Samples Used</label>
            <input type="text" id="samples_used" placeholder="Any sampled material">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="creation_status">Creation Status</label>
            <select id="creation_status">
              <option value="Complete">Complete</option>
              <option value="Incomplete">Incomplete</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="last_updated">Last Updated</label>
        <input type="date" id="last_updated">
      </div>
    </div>
    
    <div class="button-group">
      <button id="cancel-btn" type="button">Cancel</button>
      <button id="save-btn" type="button">Save Song</button>
    </div>
  </div>
  
  <div id="loading-indicator" class="loading">
    Loading...
  </div>
  
  <div id="message-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Message</h2>
        <span class="close">&times;</span>
      </div>
      <div id="modal-message"></div>
      <div class="button-group">
        <button id="modal-ok-btn">OK</button>
      </div>
    </div>
  </div>
  
  <script>
    // DOM Elements
    const themeToggle = document.getElementById('theme-toggle');
    const songList = document.getElementById('song-list');
    const songEditor = document.getElementById('song-editor');
    const songCount = document.getElementById('song-count');
    const addSongBtn = document.getElementById('add-song-btn');
    const exportBtn = document.getElementById('export-btn');
    const importBtn = document.getElementById('import-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const saveBtn = document.getElementById('save-btn');
    const modal = document.getElementById('message-modal');
    const closeModal = document.querySelector('.close');
    const modalOkBtn = document.getElementById('modal-ok-btn');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const loadingIndicator = document.getElementById('loading-indicator');
    
    // Media checkboxes
    const hasMP3 = document.getElementById('has_mp3');
    const hasWAV = document.getElementById('has_wav');
    const hasStems = document.getElementById('has_stems');
    const hasArtwork = document.getElementById('has_artwork');
    const hasVideoAcoustic = document.getElementById('has_video_acoustic');
    const hasVideoStudio = document.getElementById('has_video_studio');
    const hasChords = document.getElementById('has_chords');
    
    // Media field containers
    const mp3Fields = document.getElementById('mp3_fields');
    const wavFields = document.getElementById('wav_fields');
    const stemsFields = document.getElementById('stems_fields');
    const artworkFields = document.getElementById('artwork_fields');
    
    // Tabs
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    // State
    let songs = [];
    let currentSongIndex = -1;
    let isEditing = false;
    
    // Initialize the app when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', init);
    
    // Initialize the application
    function init() {
      console.log("Admin tool initialized"); // Debugging
      
      // Check for dark mode preference
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
        themeToggle.textContent = 'light mode';
      }
      
      // Try to load songs from localStorage
      loadSongs();
      
      // Set today's date for last_updated field
      const dateInput = document.getElementById('last_updated');
      if (dateInput) {
        dateInput.valueAsDate = new Date();
      }
      
      // Add event listeners
      addEventListeners();
    }
    
    // Toggle dark/light theme
    function toggleTheme() {
      const isDark = document.body.getAttribute('data-theme') === 'dark';
      document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
      themeToggle.textContent = isDark ? 'dark mode' : 'light mode';
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    }
    
    // Load songs from localStorage or default to empty array
    function loadSongs() {
      try {
        const savedSongs = localStorage.getItem('rad_typo_songs');
        if (savedSongs) {
          songs = JSON.parse(savedSongs);
          updateSongList();
        }
      } catch (error) {
        showMessage('Error', 'Failed to load songs: ' + error.message);
      }
    }
    
    // Save songs to localStorage
    function saveSongsToStorage() {
      try {
        localStorage.setItem('rad_typo_songs', JSON.stringify(songs));
      } catch (error) {
        showMessage('Error', 'Failed to save songs to storage: ' + error.message);
      }
    }
    
    // Update the song list display
    function updateSongList() {
      // Clear current list
      songList.innerHTML = '';
      
      // Update song count
      songCount.textContent = `${songs.length} song${songs.length !== 1 ? 's' : ''}`;
      
      if (songs.length === 0) {
        songList.innerHTML = '<div class="no-songs">No songs found. Add a new song to get started.</div>';
        return;
      }
      
      // Sort songs by date (newest first)
      const sortedSongs = [...songs].sort((a, b) => {
        return new Date(b.date || '2000-01-01') - new Date(a.date || '2000-01-01');
      });
      
      // Create song items
      sortedSongs.forEach((song, index) => {
        const songItem = document.createElement('div');
        songItem.className = 'song-item';
        
        // Create status badge
        const statusClass = `status-${(song.status || 'released').toLowerCase().replace(/\s+/g, '-')}`;
        
        songItem.innerHTML = `
          <div>
            <input type="checkbox" id="song-${index}">
            <span class="song-title">${song.title || 'Untitled'} (${song.date ? song.date.slice(0, 10) : 'No date'})</span>
            <span class="status ${statusClass}">${song.status || 'released'}</span>
          </div>
          <button class="edit-btn" data-index="${index}">Edit</button>
        `;
        
        songList.appendChild(songItem);
      });
      
      // Add click event listeners to edit buttons
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.getAttribute('data-index'));
          editSong(index);
        });
      });
    }
    
    // Show the form for adding a new song
    function showAddSongForm() {
      console.log("Adding new song"); // Debugging
      isEditing = false;
      currentSongIndex = -1;
      
      // Reset form fields
      resetForm();
      
      // Show editor
      songEditor.style.display = 'block';
      songList.style.display = 'none';
      
      // Set focus on title field
      document.getElementById('title').focus();
    }
    
    // Reset the form fields
    function resetForm() {
      // Reset all input fields
      document.querySelectorAll('input, textarea, select').forEach(field => {
        if (field.type === 'checkbox') {
          field.checked = false;
        } else if (field.type !== 'button') {
          field.value = '';
        }
      });
      
      // Set default values
      document.getElementById('status').value = 'released';
      document.getElementById('featured').value = 'No';
      document.getElementById('creation_status').value = 'Complete';
      document.getElementById('last_updated').valueAsDate = new Date();
      
      // Hide all media fields
      mp3Fields.style.display = 'none';
      wavFields.style.display = 'none';
      stemsFields.style.display = 'none';
      artworkFields.style.display = 'none';
      
      // Reset to first tab
      tabs[0].click();
    }
    
    // Hide the editor and show the song list
    function hideEditor() {
      songEditor.style.display = 'none';
      songList.style.display = 'block';
    }
    
    // Toggle media detail fields based on checkboxes
    function toggleMediaFields() {
      mp3Fields.style.display = hasMP3.checked ? 'block' : 'none';
      wavFields.style.display = hasWAV.checked ? 'block' : 'none';
      stemsFields.style.display = hasStems.checked ? 'block' : 'none';
      artworkFields.style.display = hasArtwork.checked ? 'block' : 'none';
    }
    
    // Save the current song
    function saveSong() {
      // Validate required fields
      const title = document.getElementById('title').value.trim();
      const slug = document.getElementById('slug').value.trim();
      const date = document.getElementById('date').value;
      const year = document.getElementById('year').value;
      const duration = document.getElementById('duration').value.trim();
      
      if (!title || !slug || !date || !year || !duration) {
        showMessage('Validation Error', 'Please fill in all required fields in the Basic Info tab.');
        tabs[0].click(); // Switch to Basic Info tab
        return;
      }
      
      // Collect all form data
      const songData = {
        // Basic Info
        title,
        slug,
        date,
        year,
        duration,
        status: document.getElementById('status').value,
        
        // Media Availability
        has_mp3: hasMP3.checked ? 'Yes' : 'No',
        has_wav: hasWAV.checked ? 'Yes' : 'No',
        has_stems: hasStems.checked ? 'Yes' : 'No',
        has_artwork: hasArtwork.checked ? 'Yes' : 'No',
        has_video_acoustic: hasVideoAcoustic.checked ? 'Yes' : 'No',
        has_video_studio: hasVideoStudio.checked ? 'Yes' : 'No',
        has_chords: hasChords.checked ? 'Yes' : 'No',
        
        // Media Details
        mp3_url: document.getElementById('mp3_url').value,
        mp3_size: document.getElementById('mp3_size').value,
        wav_url: document.getElementById('wav_url').value,
        wav_size: document.getElementById('wav_size').value,
        stems_url: document.getElementById('stems_url').value,
        stems_size: document.getElementById('stems_size').value,
        artwork_url: document.getElementById('artwork_url').value,
        artwork_title: document.getElementById('artwork_title').value,
        artwork_year: document.getElementById('artwork_year').value,
        artwork_medium: document.getElementById('artwork_medium').value,
        artwork_alt_text: document.getElementById('artwork_alt_text').value,
        
        // Credits
        composers: document.getElementById('composers').value,
        performers: document.getElementById('performers').value,
        engineering: document.getElementById('engineering').value,
        mixing: document.getElementById('mixing').value,
        mastering: document.getElementById('mastering').value,
        recording_location: document.getElementById('recording_location').value,
        
        // Context
        tags: document.getElementById('tags').value,
        featured: document.getElementById('featured').value,
        collection: document.getElementById('collection').value,
        series: document.getElementById('series').value,
        
        // Origin
        location: document.getElementById('location').value,
        latitude: document.getElementById('latitude').value,
        longitude: document.getElementById('longitude').value,
        date_recorded: document.getElementById('date_recorded').value,
        time_recorded: document.getElementById('time_recorded').value,
        season: document.getElementById('season').value,
        moon_phase: document.getElementById('moon_phase').value,
        temperature: document.getElementById('temperature').value,
        weather_conditions: document.getElementById('weather_conditions').value,
        
        // Content
        lyrics: document.getElementById('lyrics').value,
        public_notes: document.getElementById('public_notes').value,
        personal_notes: document.getElementById('personal_notes').value,
        instrumentation: document.getElementById('instrumentation').value,
        key: document.getElementById('key').value,
        bpm: document.getElementById('bpm').value,
        chord_progression: document.getElementById('chord_progression').value,
        
        // Archival
        story_behind: document.getElementById('story_behind').value,
        inspiration: document.getElementById('inspiration').value,
        development_history: document.getElementById('development_history').value,
        alternative_titles: document.getElementById('alternative_titles').value,
        demo_versions: document.getElementById('demo_versions').value,
        future_release_notes: document.getElementById('future_release_notes').value,
        
        // Technical
        recording_method: document.getElementById('recording_method').value,
        equipment_used: document.getElementById('equipment_used').value,
        samples_used: document.getElementById('samples_used').value,
        creation_status: document.getElementById('creation_status').value,
        last_updated: document.getElementById('last_updated').value || new Date().toISOString().split('T')[0]
      };
      
      // Update existing or add new song
      if (isEditing && currentSongIndex >= 0) {
        // Update existing song
        songs[currentSongIndex] = songData;
        showMessage('Success', `Song "${title}" updated successfully!`);
      } else {
        // Add new song
        songs.push(songData);
        showMessage('Success', `Song "${title}" added successfully!`);
      }
      
      // Save to localStorage
      saveSongsToStorage();
      
      // Update song list and hide editor
      updateSongList();
      hideEditor();
    }
    
    // Export songs to JSON file
    function exportSongs() {
      if (songs.length === 0) {
        showMessage('Export', 'No songs to export.');
        return;
      }
      
      try {
        // Create a JSON blob
        const songsJSON = JSON.stringify(songs, null, 2);
        const blob = new Blob([songsJSON], { type: 'application/json' });
        
        // Create a download link
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `rad_typo_songs_${new Date().toISOString().slice(0, 10)}.json`;
        
        // Trigger download
        document.body.appendChild(a);
        a.click();
        
        // Clean up
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showMessage('Export', 'Songs exported successfully!');
      } catch (error) {
        showMessage('Error', 'Failed to export songs: ' + error.message);
      }
    }
    
    // Handle imported JSON file
    function handleImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedSongs = JSON.parse(e.target.result);
          
          if (!Array.isArray(importedSongs)) {
            throw new Error('Invalid format: expected an array of songs');
          }
          
          // Validate basic structure
          importedSongs.forEach(song => {
            if (!song.title || !song.slug) {
              throw new Error('Invalid song data: missing required fields');
            }
          });
          
          // Confirm import
          if (confirm(`Import ${importedSongs.length} songs? This will replace your current data.`)) {
            songs = importedSongs;
            saveSongsToStorage();
            updateSongList();
            showMessage('Import', `${importedSongs.length} songs imported successfully!`);
          }
        } catch (error) {
          showMessage('Error', 'Failed to import songs: ' + error.message);
        }
      };
      reader.readAsText(file);
    }
    
    // Show modal with message
    function showMessage(title, message) {
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      modal.style.display = 'flex';
    }
    
    // Hide modal
    function hideModal() {
      modal.style.display = 'none';
    }
    
    // Generate markdown content for a song
    function generateMarkdown(song) {
      // Create YAML frontmatter
      let markdown = '---\n';
      
      // Basic info
      markdown += `title: ${song.title}\n`;
      markdown += `slug: ${song.slug}\n`;
      markdown += `date: ${song.date}\n`;
      markdown += `year: ${song.year}\n`;
      markdown += `duration: ${song.duration}\n`;
      markdown += `status: ${song.status}\n\n`;
      
      // Media availability
      markdown += '# Media Details\n';
      markdown += 'media:\n';
      
      // MP3
      if (song.has_mp3 === 'Yes' && song.mp3_url) {
        markdown += '  - type: mp3\n';
        markdown += `    url: ${song.mp3_url}\n`;
        if (song.mp3_size) markdown += `    size: ${song.mp3_size}\n`;
      }
      
      // WAV
      if (song.has_wav === 'Yes' && song.wav_url) {
        markdown += '  - type: wav\n';
        markdown += `    url: ${song.wav_url}\n`;
        if (song.wav_size) markdown += `    size: ${song.wav_size}\n`;
      }
      
      // Stems
      if (song.has_stems === 'Yes' && song.stems_url) {
        markdown += '  - type: stems\n';
        markdown += `    url: ${song.stems_url}\n`;
        if (song.stems_size) markdown += `    size: ${song.stems_size}\n`;
      }
      
      // Artwork
      if (song.has_artwork === 'Yes' && song.artwork_url) {
        markdown += '  - type: artwork\n';
        markdown += `    url: ${song.artwork_url}\n`;
        if (song.artwork_alt_text) markdown += `    alt: "${song.artwork_alt_text}"\n`;
        if (song.artwork_title) markdown += `    title: "${song.artwork_title}"\n`;
        if (song.artwork_year) markdown += `    year: ${song.artwork_year}\n`;
        if (song.artwork_medium) markdown += `    medium: "${song.artwork_medium}"\n`;
      }
      
      // Add other media types here
      
      markdown += '\n';
      
      // Credits
      if (song.composers || song.performers || song.engineering || song.mixing || song.mastering || song.recording_location) {
        markdown += '# Credits\n';
        markdown += 'credits:\n';
        
        if (song.composers) {
          markdown += '  composers:\n';
          song.composers.split('\n').forEach(composer => {
            if (composer.trim()) markdown += `    - ${composer.trim()}\n`;
          });
        }
        
        if (song.performers) {
          markdown += '  performers:\n';
          song.performers.split('\n').forEach(performer => {
            if (performer.trim()) markdown += `    - ${performer.trim()}\n`;
          });
        }
        
        if (song.engineering) markdown += `  engineering: ${song.engineering}\n`;
        if (song.mixing) markdown += `  mixing: ${song.mixing}\n`;
        if (song.mastering) markdown += `  mastering: ${song.mastering}\n`;
        
        if (song.recording_location) {
          markdown += `recording_location: ${song.recording_location}\n`;
        }
        
        markdown += '\n';
      }
      
      // Context & Categorization
      if (song.tags || song.featured || song.collection || song.series) {
        markdown += '# Context & Categorization\n';
        
        if (song.tags) {
          const tagArray = song.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
          if (tagArray.length > 0) {
            markdown += 'tags:\n';
            tagArray.forEach(tag => {
              markdown += `  - ${tag}\n`;
            });
          }
        }
        
        if (song.featured === 'Yes') markdown += 'featured: true\n';
        if (song.collection) markdown += `collection: ${song.collection}\n`;
        if (song.series) markdown += `series: ${song.series}\n`;
        
        markdown += '\n';
      }
      
      // Origin Context
      if (song.location || song.latitude || song.longitude || song.date_recorded || 
          song.time_recorded || song.season || song.moon_phase || song.temperature || 
          song.weather_conditions) {
        
        markdown += '# Origin Context\n';
        markdown += 'origin:\n';
        
        if (song.location) markdown += `  location: "${song.location}"\n`;
        
        if (song.latitude || song.longitude) {
          markdown += '  coordinates:\n';
          if (song.latitude) markdown += `    latitude: ${song.latitude}\n`;
          if (song.longitude) markdown += `    longitude: ${song.longitude}\n`;
        }
        
        if (song.season || song.moon_phase) {
          markdown += '  celestial:\n';
          if (song.season) markdown += `    season: "${song.season}"\n`;
          if (song.moon_phase) markdown += `    moonPhase: "${song.moon_phase}"\n`;
        }
        
        if (song.temperature || song.weather_conditions) {
          markdown += '  environmental:\n';
          if (song.temperature) markdown += `    temperature: ${song.temperature}\n`;
          if (song.weather_conditions) markdown += `    conditions: "${song.weather_conditions}"\n`;
        }
        
        markdown += '\n';
      }
      
      // Technical content
      if (song.instrumentation || song.key || song.bpm || song.chord_progression) {
        if (song.instrumentation) markdown += `instrumentation: ${song.instrumentation}\n`;
        if (song.key) markdown += `key: ${song.key}\n`;
        if (song.bpm) markdown += `bpm: ${song.bpm}\n`;
        if (song.chord_progression) markdown += `chord_progression: ${song.chord_progression}\n`;
        markdown += '\n';
      }
      
      // Notes
      if (song.public_notes) {
        markdown += `notes: ${song.public_notes}\n`;
      }
      
      // End frontmatter
      markdown += '---\n\n';
      
      // Add lyrics as main content
      if (song.lyrics) {
        markdown += song.lyrics;
      }
      
      return markdown;
    }
    
    // Export a single song as markdown file
    function exportMarkdown(song) {
      const markdown = generateMarkdown(song);
      
      // Create a blob and trigger download
      const blob = new Blob([markdown], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${song.slug}.md`;
      
      document.body.appendChild(a);
      a.click();
      
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    
    // Add button to export all songs as markdown files
    function addExportMarkdownButton() {
      const actionsDiv = document.querySelector('.actions div:first-child');
      
      // Create button if it doesn't exist
      if (!document.getElementById('export-markdown-btn')) {
        const exportMarkdownBtn = document.createElement('button');
        exportMarkdownBtn.id = 'export-markdown-btn';
        exportMarkdownBtn.textContent = 'Export Markdown';
        exportMarkdownBtn.addEventListener('click', exportAllMarkdown);
        
        actionsDiv.appendChild(exportMarkdownBtn);
      }
    }
    
    // Export all songs as markdown files (zipped)
    function exportAllMarkdown() {
      if (songs.length === 0) {
        showMessage('Export', 'No songs to export.');
        return;
      }
      
      showMessage('Export', 'This would export all songs as individual markdown files. For now, please use the Edit button on each song and copy the markdown content.');
    }
    
    // Add generate markdown button to song editor
    function addGenerateMarkdownButton() {
      const buttonGroup = document.querySelector('.button-group');
      
      // Create button if it doesn't exist
      if (!document.getElementById('generate-markdown-btn')) {
        const generateMarkdownBtn = document.createElement('button');
        generateMarkdownBtn.id = 'generate-markdown-btn';
        generateMarkdownBtn.type = 'button';
        generateMarkdownBtn.textContent = 'Generate Markdown';
        
        generateMarkdownBtn.addEventListener('click', function() {
          // Collect all form data to create a temporary song object
          const tempSong = {
            // Basic Info
            title: document.getElementById('title').value.trim(),
            slug: document.getElementById('slug').value.trim(),
            date: document.getElementById('date').value,
            year: document.getElementById('year').value,
            duration: document.getElementById('duration').value.trim(),
            status: document.getElementById('status').value,
            
            // Media Availability
            has_mp3: hasMP3.checked ? 'Yes' : 'No',
            has_wav: hasWAV.checked ? 'Yes' : 'No',
            has_stems: hasStems.checked ? 'Yes' : 'No',
            has_artwork: hasArtwork.checked ? 'Yes' : 'No',
            has_video_acoustic: hasVideoAcoustic.checked ? 'Yes' : 'No',
            has_video_studio: hasVideoStudio.checked ? 'Yes' : 'No',
            has_chords: hasChords.checked ? 'Yes' : 'No',
            
            // Media Details
            mp3_url: document.getElementById('mp3_url').value,
            mp3_size: document.getElementById('mp3_size').value,
            wav_url: document.getElementById('wav_url').value,
            wav_size: document.getElementById('wav_size').value,
            stems_url: document.getElementById('stems_url').value,
            stems_size: document.getElementById('stems_size').value,
            artwork_url: document.getElementById('artwork_url').value,
            artwork_title: document.getElementById('artwork_title').value,
            artwork_year: document.getElementById('artwork_year').value,
            artwork_medium: document.getElementById('artwork_medium').value,
            artwork_alt_text: document.getElementById('artwork_alt_text').value,
            
            // Credits
            composers: document.getElementById('composers').value,
            performers: document.getElementById('performers').value,
            engineering: document.getElementById('engineering').value,
            mixing: document.getElementById('mixing').value,
            mastering: document.getElementById('mastering').value,
            recording_location: document.getElementById('recording_location').value,
            
            // Context
            tags: document.getElementById('tags').value,
            featured: document.getElementById('featured').value,
            collection: document.getElementById('collection').value,
            series: document.getElementById('series').value,
            
            // Origin
            location: document.getElementById('location').value,
            latitude: document.getElementById('latitude').value,
            longitude: document.getElementById('longitude').value,
            date_recorded: document.getElementById('date_recorded').value,
            time_recorded: document.getElementById('time_recorded').value,
            season: document.getElementById('season').value,
            moon_phase: document.getElementById('moon_phase').value,
            temperature: document.getElementById('temperature').value,
            weather_conditions: document.getElementById('weather_conditions').value,
            
            // Content
            lyrics: document.getElementById('lyrics').value,
            public_notes: document.getElementById('public_notes').value,
            personal_notes: document.getElementById('personal_notes').value,
            instrumentation: document.getElementById('instrumentation').value,
            key: document.getElementById('key').value,
            bpm: document.getElementById('bpm').value,
            chord_progression: document.getElementById('chord_progression').value,
          };
          
          // Generate and display markdown
          const markdown = generateMarkdown(tempSong);
          
          // Create modal to show markdown
          const markdownModal = document.createElement('div');
          markdownModal.className = 'modal';
          markdownModal.style.display = 'flex';
          
          markdownModal.innerHTML = `
            <div class="modal-content" style="width: 90%; max-width: 800px; height: 80vh;">
              <div class="modal-header">
                <h2>Markdown for ${tempSong.title}</h2>
                <span class="close">&times;</span>
              </div>
              <div style="margin-bottom: 15px;">
                <p>Copy this markdown to create your song file (${tempSong.slug}.md):</p>
              </div>
              <div style="height: calc(100% - 150px); overflow: auto;">
                <pre style="white-space: pre-wrap; border: 1px solid var(--border-color); padding: 10px; background-color: var(--header-color);">${markdown}</pre>
              </div>
              <div class="button-group">
                <button id="copy-markdown-btn">Copy to Clipboard</button>
                <button id="download-markdown-btn">Download as File</button>
                <button id="close-markdown-modal-btn">Close</button>
              </div>
            </div>
          `;
          
          document.body.appendChild(markdownModal);
          
          // Close button
          const closeBtn = markdownModal.querySelector('.close');
          closeBtn.addEventListener('click', () => {
            document.body.removeChild(markdownModal);
          });
          
          // Copy to clipboard button
          const copyBtn = markdownModal.querySelector('#copy-markdown-btn');
          copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(markdown)
              .then(() => {
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                  copyBtn.textContent = 'Copy to Clipboard';
                }, 2000);
              })
              .catch(err => {
                console.error('Failed to copy: ', err);
              });
          });
          
          // Download button
          const downloadBtn = markdownModal.querySelector('#download-markdown-btn');
          downloadBtn.addEventListener('click', () => {
            exportMarkdown(tempSong);
          });
          
          // Close modal button
          const closeModalBtn = markdownModal.querySelector('#close-markdown-modal-btn');
          closeModalBtn.addEventListener('click', () => {
            document.body.removeChild(markdownModal);
          });
        });
        
        buttonGroup.insertBefore(generateMarkdownBtn, buttonGroup.firstChild);
      }
    }
    
    // Initialize markdown features
    function initMarkdownFeatures() {
      addExportMarkdownButton();
      addGenerateMarkdownButton();
    }
    
    // Add event listeners function should call this
    initMarkdownFeatures();
    
    // Load song data into the form for editing
    function editSong(index) {
      console.log("Editing song at index:", index); // Debugging
      isEditing = true;
      currentSongIndex = index;
      const song = songs[index];
      
      if (!song) {
        showMessage('Error', 'Song not found');
        return;
      }
      
      // Populate basic info
      document.getElementById('title').value = song.title || '';
      document.getElementById('slug').value = song.slug || '';
      document.getElementById('date').value = song.date || '';
      document.getElementById('year').value = song.year || '';
      document.getElementById('duration').value = song.duration || '';
      document.getElementById('status').value = song.status || 'released';
      
      // Populate media availability
      document.getElementById('has_mp3').checked = song.has_mp3 === 'Yes';
      document.getElementById('has_wav').checked = song.has_wav === 'Yes';
      document.getElementById('has_stems').checked = song.has_stems === 'Yes';
      document.getElementById('has_artwork').checked = song.has_artwork === 'Yes';
      document.getElementById('has_video_acoustic').checked = song.has_video_acoustic === 'Yes';
      document.getElementById('has_video_studio').checked = song.has_video_studio === 'Yes';
      document.getElementById('has_chords').checked = song.has_chords === 'Yes';
      
      // Toggle media fields visibility based on checkboxes
      toggleMediaFields();
      
      // Populate media details
      if (song.has_mp3 === 'Yes') {
        document.getElementById('mp3_url').value = song.mp3_url || '';
        document.getElementById('mp3_size').value = song.mp3_size || '';
      }
      
      if (song.has_wav === 'Yes') {
        document.getElementById('wav_url').value = song.wav_url || '';
        document.getElementById('wav_size').value = song.wav_size || '';
      }
      
      if (song.has_stems === 'Yes') {
        document.getElementById('stems_url').value = song.stems_url || '';
        document.getElementById('stems_size').value = song.stems_size || '';
      }
      
      if (song.has_artwork === 'Yes') {
        document.getElementById('artwork_url').value = song.artwork_url || '';
        document.getElementById('artwork_title').value = song.artwork_title || '';
        document.getElementById('artwork_year').value = song.artwork_year || '';
        document.getElementById('artwork_medium').value = song.artwork_medium || '';
        document.getElementById('artwork_alt_text').value = song.artwork_alt_text || '';
      }
      
      // Populate credits
      document.getElementById('composers').value = song.composers || '';
      document.getElementById('performers').value = song.performers || '';
      document.getElementById('engineering').value = song.engineering || '';
      document.getElementById('mixing').value = song.mixing || '';
      document.getElementById('mastering').value = song.mastering || '';
      document.getElementById('recording_location').value = song.recording_location || '';
      
      // Populate context
      document.getElementById('tags').value = song.tags || '';
      document.getElementById('featured').value = song.featured || 'No';
      document.getElementById('collection').value = song.collection || '';
      document.getElementById('series').value = song.series || '';
      
      // Populate origin
      document.getElementById('location').value = song.location || '';
      document.getElementById('latitude').value = song.latitude || '';
      document.getElementById('longitude').value = song.longitude || '';
      document.getElementById('date_recorded').value = song.date_recorded || '';
      document.getElementById('time_recorded').value = song.time_recorded || '';
      document.getElementById('season').value = song.season || '';
      document.getElementById('moon_phase').value = song.moon_phase || '';
      document.getElementById('temperature').value = song.temperature || '';
      document.getElementById('weather_conditions').value = song.weather_conditions || '';
      
      // Populate content
      document.getElementById('lyrics').value = song.lyrics || '';
      document.getElementById('public_notes').value = song.public_notes || '';
      document.getElementById('personal_notes').value = song.personal_notes || '';
      document.getElementById('instrumentation').value = song.instrumentation || '';
      document.getElementById('key').value = song.key || '';
      document.getElementById('bpm').value = song.bpm || '';
      document.getElementById('chord_progression').value = song.chord_progression || '';
      
      // Populate archival
      document.getElementById('story_behind').value = song.story_behind || '';
      document.getElementById('inspiration').value = song.inspiration || '';
      document.getElementById('development_history').value = song.development_history || '';
      document.getElementById('alternative_titles').value = song.alternative_titles || '';
      document.getElementById('demo_versions').value = song.demo_versions || '';
      document.getElementById('future_release_notes').value = song.future_release_notes || '';
      
      // Populate technical
      document.getElementById('recording_method').value = song.recording_method || '';
      document.getElementById('equipment_used').value = song.equipment_used || '';
      document.getElementById('samples_used').value = song.samples_used || '';
      document.getElementById('creation_status').value = song.creation_status || 'Complete';
      document.getElementById('last_updated').value = song.last_updated || new Date().toISOString().split('T')[0];
      
      // Show editor
      songEditor.style.display = 'block';
      songList.style.display = 'none';
    }
    
    // Add all event listeners
    function addEventListeners() {
      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);
      
      // Button event listeners
      addSongBtn.addEventListener('click', showAddSongForm);
      cancelBtn.addEventListener('click', hideEditor);
      saveBtn.addEventListener('click', saveSong);
      exportBtn.addEventListener('click', exportSongs);
      importBtn.addEventListener('click', function() {
        // Trigger file input for importing
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = handleImport;
        input.click();
      });
      
      // Modal event listeners
      closeModal.addEventListener('click', hideModal);
      modalOkBtn.addEventListener('click', hideModal);
      
      // Media checkbox event listeners
      hasMP3.addEventListener('change', toggleMediaFields);
      hasWAV.addEventListener('change', toggleMediaFields);
      hasStems.addEventListener('change', toggleMediaFields);
      hasArtwork.addEventListener('change', toggleMediaFields);
      hasVideoAcoustic.addEventListener('change', toggleMediaFields);
      hasVideoStudio.addEventListener('change', toggleMediaFields);
      hasChords.addEventListener('change', toggleMediaFields);
      
      // Tab switching
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs and contents
          tabs.forEach(t => t.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // Add active class to clicked tab and corresponding content
          tab.classList.add('active');
          const tabId = tab.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
        });
      });
    }
