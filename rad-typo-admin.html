<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>rad.typo admin (simplified)</title>
  <style>
    /* CSS Variables for theming */
    :root {
      --bg-color: #fff;
      --text-color: #000;
      --accent-color: #666;
      --border-color: #ccc;
      --header-color: #efefef;
      --focus-color: #0056b3;
    }
    
    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #fff;
      --accent-color: #999;
      --border-color: #444;
      --header-color: #333;
      --focus-color: #5c9eff;
    }
    
    /* Base styles */
    body {
      font-family: monospace;
      background-color: var(--bg-color);
      color: var(--text-color);
      max-width: 90%;
      margin: 20px auto;
      padding: 20px;
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    /* Actions bar */
    .actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 10px;
      background-color: var(--header-color);
      border-radius: 4px;
    }
    
    /* Song list styles */
    .song-list {
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    
    .song-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .song-item:last-child {
      border-bottom: none;
    }
    
    .song-title {
      flex-grow: 1;
      margin-left: 10px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 0;
    }
    
    .tab {
      padding: 10px 15px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      margin-bottom: -1px;
      background-color: var(--bg-color);
    }
    
    .tab.active {
      border-color: var(--border-color);
      border-bottom-color: var(--bg-color);
      font-weight: bold;
    }
    
    /* Tab content */
    .tab-content {
      display: none;
      padding: 20px;
      border: 1px solid var(--border-color);
      border-top: none;
      border-radius: 0 0 4px 4px;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Form styles */
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    
    .form-col {
      flex: 1;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: monospace;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--focus-color);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    /* Buttons */
    button {
      padding: 8px 12px;
      background-color: var(--accent-color);
      color: var(--bg-color);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: monospace;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .button-group {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }
    
    /* Status indicators */
    .status {
      padding: 3px 6px;
      border-radius: 3px;
      font-size: 0.8em;
    }
    
    .status-released {
      background-color: #28a745;
      color: white;
    }
    
    .status-in-progress {
      background-color: #ffc107;
      color: black;
    }
    
    .status-archive {
      background-color: #6c757d;
      color: white;
    }
    
    /* Song editor display state */
    #song-editor {
      display: none;
    }
    
    /* Modal for messages */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: var(--bg-color);
      padding: 20px;
      border-radius: 5px;
      width: 80%;
      max-width: 500px;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .close {
      font-size: 24px;
      cursor: pointer;
    }
    
    /* Media fields container */
    .media-fields {
      border: 1px solid var(--border-color);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 4px;
    }
    
    .media-type {
      font-weight: bold;
      margin-bottom: 10px;
    }

    /* No songs message */
    .no-songs {
      text-align: center;
      padding: 20px;
      color: var(--accent-color);
    }

    /* Error message */
    .error {
      color: #dc3545;
      margin-top: 5px;
      font-size: 0.9em;
    }
    
    /* Markdown output */
    #markdown-output {
      white-space: pre-wrap;
      border: 1px solid var(--border-color);
      padding: 10px;
      background-color: var(--header-color);
      height: 300px;
      overflow: auto;
      display: none;
    }
    
    /* Mobile-friendly adjustments */
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 10px;
      }
      
      .tabs {
        flex-wrap: wrap;
      }
      
      .tab {
        flex-grow: 1;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>rad.typo admin</h1>
    <button id="theme-toggle" onclick="toggleTheme()">dark mode</button>
  </header>
  
  <div class="actions">
    <div>
      <button id="add-song-btn" onclick="showAddSongForm()">Add New Song</button>
      <button id="generate-markdown-btn" onclick="generateMarkdown()">Generate Markdown</button>
    </div>
    <div id="song-count">2 sample songs</div>
  </div>
  
  <div id="song-list" class="song-list">
    <div class="song-item">
      <div>
        <input type="checkbox" id="song-0">
        <span class="song-title">Bad Fortune (2020-01-24)</span>
        <span class="status status-released">released</span>
      </div>
      <button class="edit-btn" onclick="editSong(0)">Edit</button>
    </div>
    <div class="song-item">
      <div>
        <input type="checkbox" id="song-1">
        <span class="song-title">Method to Her Madness (2023-03-15)</span>
        <span class="status status-in-progress">in-progress</span>
      </div>
      <button class="edit-btn" onclick="editSong(1)">Edit</button>
    </div>
  </div>
  
  <div id="song-editor">
    <div class="tabs">
      <div class="tab active" onclick="switchTab('basic-info', this)">Basic Info</div>
      <div class="tab" onclick="switchTab('media', this)">Media</div>
      <div class="tab" onclick="switchTab('credits', this)">Credits</div>
      <div class="tab" onclick="switchTab('context', this)">Context</div>
      <div class="tab" onclick="switchTab('origin', this)">Origin</div>
      <div class="tab" onclick="switchTab('content', this)">Content</div>
    </div>
    
    <div id="basic-info" class="tab-content active">
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="title">Title*</label>
            <input type="text" id="title" required>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="slug">Slug*</label>
            <input type="text" id="slug" required>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="date">Date*</label>
            <input type="date" id="date" required>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="year">Year*</label>
            <input type="number" id="year" required min="1900" max="2100">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="duration">Duration*</label>
            <input type="text" id="duration" required placeholder="e.g. 3:43">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="status">Status*</label>
        <select id="status" required>
          <option value="released">Released</option>
          <option value="in-progress">In Progress</option>
          <option value="archive">Archive</option>
        </select>
      </div>
    </div>
    
    <div id="media" class="tab-content">
      <h3>Media Availability</h3>
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_mp3" onchange="toggleMediaFields()"> Has MP3
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_wav" onchange="toggleMediaFields()"> Has WAV
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_stems" onchange="toggleMediaFields()"> Has Stems
            </label>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label>
              <input type="checkbox" id="has_artwork" onchange="toggleMediaFields()"> Has Artwork
            </label>
          </div>
        </div>
      </div>
      
      <div id="mp3_fields" class="media-fields" style="display: none;">
        <div class="media-type">MP3 Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="mp3_url">MP3 URL</label>
              <input type="url" id="mp3_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="mp3_size">MP3 Size (MB)</label>
              <input type="number" id="mp3_size" step="0.1">
            </div>
          </div>
        </div>
      </div>
      
      <div id="wav_fields" class="media-fields" style="display: none;">
        <div class="media-type">WAV Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="wav_url">WAV URL</label>
              <input type="url" id="wav_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="wav_size">WAV Size (MB)</label>
              <input type="number" id="wav_size" step="0.1">
            </div>
          </div>
        </div>
      </div>
      
      <div id="stems_fields" class="media-fields" style="display: none;">
        <div class="media-type">Stems Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="stems_url">Stems URL</label>
              <input type="url" id="stems_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="stems_size">Stems Size (MB)</label>
              <input type="number" id="stems_size" step="0.1">
            </div>
          </div>
        </div>
      </div>
      
      <div id="artwork_fields" class="media-fields" style="display: none;">
        <div class="media-type">Artwork Details</div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_url">Artwork URL</label>
              <input type="url" id="artwork_url" placeholder="https://f003.backblazeb2.com/file/...">
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_title">Artwork Title</label>
              <input type="text" id="artwork_title" placeholder="e.g. 'We'll be lucky if I don't bust out crying'">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_year">Artwork Year</label>
              <input type="number" id="artwork_year" min="1900" max="2100">
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_medium">Artwork Medium</label>
              <input type="text" id="artwork_medium" placeholder="e.g. 'Acrylic on canvas'">
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="artwork_alt_text">Artwork Alt Text</label>
              <input type="text" id="artwork_alt_text" placeholder="Accessibility description">
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="credits" class="tab-content">
      <div class="form-group">
        <label for="composers">Composers (one per line with percentages)</label>
        <textarea id="composers" placeholder="Andrew Ferris (33%)&#10;Caolán Austin (33%)&#10;Chris Cassidy (33%)"></textarea>
      </div>
      
      <div class="form-group">
        <label for="performers">Performers (one per line with roles)</label>
        <textarea id="performers" placeholder="Andrew Ferris: Vocals, Guitar, Keyboard&#10;Caolán Austin: Drums, Percussion, Guitar&#10;Chris Cassidy: Bass"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="engineering">Engineering</label>
            <input type="text" id="engineering" placeholder="Who recorded">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="mixing">Mixing</label>
            <input type="text" id="mixing" placeholder="Who mixed">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="mastering">Mastering</label>
            <input type="text" id="mastering" placeholder="Who mastered">
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="recording_location">Recording Location</label>
        <input type="text" id="recording_location" placeholder="Studio name, city, country">
      </div>
    </div>
    
    <div id="context" class="tab-content">
      <div class="form-group">
        <label for="tags">Tags (comma separated)</label>
        <input type="text" id="tags" placeholder="e.g. electronic, featured">
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="featured">Featured</label>
            <select id="featured">
              <option value="Yes">Yes</option>
              <option value="No" selected>No</option>
            </select>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="collection">Collection</label>
            <input type="text" id="collection" placeholder="Album/EP it belongs to">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="series">Series</label>
            <input type="text" id="series" placeholder="Thematic series">
          </div>
        </div>
      </div>
    </div>
    
    <div id="origin" class="tab-content">
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="location">Location</label>
            <input type="text" id="location" placeholder="City, Country">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="latitude">Latitude</label>
            <input type="number" id="latitude" step="0.0001" placeholder="e.g. 54.9966">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="longitude">Longitude</label>
            <input type="number" id="longitude" step="0.0001" placeholder="e.g. -7.3086">
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="season">Season</label>
            <select id="season">
              <option value="">Select season</option>
              <option value="Imbolc">Imbolc</option>
              <option value="Beltane">Beltane</option>
              <option value="Lughnasadh">Lughnasadh</option>
              <option value="Samhain">Samhain</option>
            </select>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="moon_phase">Moon Phase</label>
            <select id="moon_phase">
              <option value="">Select moon phase</option>
              <option value="New Moon">New Moon</option>
              <option value="Waxing Crescent">Waxing Crescent</option>
              <option value="First Quarter">First Quarter</option>
              <option value="Waxing Gibbous">Waxing Gibbous</option>
              <option value="Full Moon">Full Moon</option>
              <option value="Waning Gibbous">Waning Gibbous</option>
              <option value="Last Quarter">Last Quarter</option>
              <option value="Waning Crescent">Waning Crescent</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="temperature">Temperature (°C)</label>
            <input type="number" id="temperature" step="0.1" placeholder="e.g. 7.3">
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="weather_conditions">Weather Conditions</label>
            <input type="text" id="weather_conditions" placeholder="e.g. Light Rain">
          </div>
        </div>
      </div>
    </div>
    
    <div id="content" class="tab-content">
      <div class="form-group">
        <label for="lyrics">Lyrics</label>
        <textarea id="lyrics" rows="10" placeholder="Full song lyrics"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="public_notes">Public Notes</label>
            <textarea id="public_notes" placeholder="Notes to display on the site"></textarea>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="personal_notes">Personal Notes</label>
            <textarea id="personal_notes" placeholder="Private archival notes"></textarea>
          </div>
        </div>
      </div>
    </div>
    
    <div class="button-group">
      <button id="cancel-btn" onclick="hideEditor()">Cancel</button>
      <button id="save-btn" onclick="saveSong()">Save Song</button>
    </div>
  </div>
  
  <div id="markdown-output"></div>
  
  <div id="message-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Message</h2>
        <span class="close" onclick="hideModal()">&times;</span>
      </div>
      <div id="modal-message"></div>
      <div class="button-group">
        <button id="modal-ok-btn" onclick="hideModal()">OK</button>
      </div>
    </div>
  </div>
  
  <script>
    // Sample songs data
    const sampleSongs = [
      {
        title: "Bad Fortune",
        slug: "bad-fortune",
        date: "2020-01-24",
        year: "2020",
        duration: "3:43",
        status: "released",
        has_mp3: "Yes",
        has_wav: "Yes",
        has_stems: "Yes",
        has_artwork: "Yes",
        mp3_url: "https://f003.backblazeb2.com/file/rad-typo/audio/bad-fortune.mp3",
        mp3_size: "8.4",
        wav_url: "https://f003.backblazeb2.com/file/rad-typo/audio/bad-fortune.wav",
        wav_size: "42.0",
        stems_url: "https://f003.backblazeb2.com/file/rad-typo/audio/bad-fortune-stems.zip",
        stems_size: "120.0",
        artwork_url: "https://f003.backblazeb2.com/file/rad-typo/images/bad-fortune-artwork.jpg",
        artwork_title: "We'll be lucky if I don't bust out crying",
        artwork_year: "2020",
        artwork_medium: "Acrylic on canvas",
        artwork_alt_text: "Pink squirrel painting",
        composers: "Andrew Ferris (33%)\nCaolán Austin (33%)\nChris Cassidy (33%)",
        performers: "Andrew Ferris: Vocals, Guitar, Keyboard\nCaolán Austin: Drums, Percussion, Guitar\nChris Cassidy: Bass",
        engineering: "All composers",
        mixing: "Caolán Austin",
        mastering: "Caolán Austin",
        recording_location: "Smalltown America Studio, Derry, Northern Ireland",
        tags: "electronic, featured",
        featured: "Yes",
        location: "Derry, Northern Ireland",
        latitude: "54.9966",
        longitude: "-7.3086",
        season: "Imbolc",
        moon_phase: "Waning Crescent",
        temperature: "7.3",
        weather_conditions: "Light Rain",
        lyrics: "I'm happy to go\nWhere the algorithm takes us...\n\n(More lyrics would go here)",
        public_notes: "A song about algorithmic misfortune and laundromats."
      },
      {
        title: "Method to Her Madness",
        slug: "method-to-her-madness",
        date: "2023-03-15",
        year: "2023",
        duration: "4:22",
        status: "in-progress",
        has_mp3: "Yes",
        has_artwork: "Yes",
        mp3_url: "https://f003.backblazeb2.com/file/rad-typo/audio/method-to-her-madness.mp3",
        mp3_size: "9.6",
        artwork_url: "https://f003.backblazeb2.com/file/rad-typo/images/method-to-her-madness-artwork.jpg",
        artwork_alt_text: "Green abstract painting",
        composers: "Andrew Ferris (50%)\nCaolán Austin (50%)",
        performers: "Andrew Ferris: Vocals, Guitar\nCaolán Austin: Drums, Bass, Synth",
        recording_location: "Home Studio, Belfast",
        tags: "electronic, ambient",
        season: "Beltane",
        lyrics: "The method to her madness\nWas always crystal clear...\n\n(More lyrics would go here)"
      }
    ];
    
    // Current song being edited
    let currentSongIndex = -1;
    
    // Toggle dark/light theme
    function toggleTheme() {
      const body = document.documentElement;
      const button = document.getElementById('theme-toggle');
      const isDark = body.getAttribute('data-theme') === 'dark';
      
      body.setAttribute('data-theme', isDark ? 'light' : 'dark');
      button.textContent = isDark ? 'dark mode' : 'light mode';
    }
    
    // Switch between tabs
    function switchTab(tabId, clickedTab) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content and mark tab as active
      document.getElementById(tabId).classList.add('active');
      clickedTab.classList.add('active');
    }
    
    // Show the form for adding a new song
    function showAddSongForm() {
      currentSongIndex = -1;
      
      // Reset form fields
      resetForm();
      
      // Show editor and hide list
      document.getElementById('song-editor').style.display = 'block';
      document.getElementById('song-list').style.display = 'none';
      document.getElementById('markdown-output').style.display = 'none';
    }
    
    // Reset form fields
    function resetForm() {
      // Reset all input fields
      document.querySelectorAll('input, textarea, select').forEach(field => {
        if (field.type === 'checkbox') {
          field.checked = false;
        } else if (field.type !== 'button') {
          field.value = '';
        }
      });
      
      // Set default values
      document.getElementById('status').value = 'released';
      document.getElementById('featured').value = 'No';
      
      // Hide all media fields
      document.getElementById('mp3_fields').style.display = 'none';
      document.getElementById('wav_fields').style.display = 'none';
      document.getElementById('stems_fields').style.display = 'none';
      document.getElementById('artwork_fields').style.display = 'none';
    }
    
    // Hide the editor and show the song list
    function hideEditor() {
      document.getElementById('song-editor').style.display = 'none';
      document.getElementById('song-list').style.display = 'block';
      document.getElementById('markdown-output').style.display = 'none';
    }
    
    // Toggle media detail fields based on checkboxes
    function toggleMediaFields() {
      const hasMP3 = document.getElementById('has_mp3').checked;
      const hasWAV = document.getElementById('has_wav').checked;
      const hasStems = document.getElementById('has_stems').checked;
      const hasArtwork = document.getElementById('has_artwork').checked;
      
      document.getElementById('mp3_fields').style.display = hasMP3 ? 'block' : 'none';
      document.getElementById('wav_fields').style.display = hasWAV ? 'block' : 'none';
      document.getElementById('stems_fields').style.display = hasStems ? 'block' : 'none';
      document.getElementById('artwork_fields').style.display = hasArtwork ? 'block' : 'none';
    }
    
    // Edit an existing song
    function editSong(index) {
      currentSongIndex = index;
      const song = sampleSongs[index];
      
      // Populate basic info
      document.getElementById('title').value = song.title || '';
      document.getElementById('slug').value = song.slug || '';
      document.getElementById('date').value = song.date || '';
      document.getElementById('year').value = song.year || '';
      document.getElementById('duration').value = song.duration || '';
      document.getElementById('status').value = song.status || 'released';
      
      // Populate media availability
      document.getElementById('has_mp3').checked = song.has_mp3 === 'Yes';
      document.getElementById('has_wav').checked = song.has_wav === 'Yes';
      document.getElementById('has_stems').checked = song.has_stems === 'Yes';
      document.getElementById('has_artwork').checked = song.has_artwork === 'Yes';
      
      // Toggle media fields visibility
      toggleMediaFields();
      
      // Populate media details if available
      if (song.has_mp3 === 'Yes') {
        document.getElementById('mp3_url').value = song.mp3_url || '';
        document.getElementById('mp3_size').value = song.mp3_size || '';
      }
      
      if (song.has_wav === 'Yes') {
        document.getElementById('wav_url').value = song.wav_url || '';
        document.getElementById('wav_size').value = song.wav_size || '';
      }
      
      if (song.has_stems === 'Yes') {
        document.getElementById('stems_url').value = song.stems_url || '';
        document.getElementById('stems_size').value = song.stems_size || '';
      }
      
      if (song.has_artwork === 'Yes') {
        document.getElementById('artwork_url').value = song.artwork_url || '';
        document.getElementById('artwork_title').value = song.artwork_title || '';
        document.getElementById('artwork_year').value = song.artwork_year || '';
        document.getElementById('artwork_medium').value = song.artwork_medium || '';
        document.getElementById('artwork_alt_text').value = song.artwork_alt_text || '';
      }
      
      // Populate credits
      document.getElementById('composers').value = song.composers || '';
      document.getElementById('performers').value = song.performers || '';
      document.getElementById('engineering').value = song.engineering || '';
      document.getElementById('mixing').value = song.mixing || '';
      document.getElementById('mastering').value = song.mastering || '';
      document.getElementById('recording_location').value = song.recording_location || '';
      
      // Populate context
      document.getElementById('tags').value = song.tags || '';
      document.getElementById('featured').value = song.featured || 'No';
      document.getElementById('collection').value = song.collection || '';
      document.getElementById('series').value = song.series || '';
      
      // Populate origin
      document.getElementById('location').value = song.location || '';
      document.getElementById('latitude').value = song.latitude || '';
      document.getElementById('longitude').value = song.longitude || '';
      document.getElementById('season').value = song.season || '';
      document.getElementById('moon_phase').value = song.moon_phase || '';
      document.getElementById('temperature').value = song.temperature || '';
      document.getElementById('weather_conditions').value = song.weather_conditions || '';
      
      // Populate content
      document.getElementById('lyrics').value = song.lyrics || '';
      document.getElementById('public_notes').value = song.public_notes || '';
      document.getElementById('personal_notes').value = song.personal_notes || '';
      
      // Show editor and hide list
      document.getElementById('song-editor').style.display = 'block';
      document.getElementById('song-list').style.display = 'none';
      document.getElementById('markdown-output').style.display = 'none';
    }
    
    // Save current song (simulate)
    function saveSong() {
      // Perform validation
      const title = document.getElementById('title').value.trim();
      if (!title) {
        showMessage('Error', 'Title is required.');
        return;
      }
      
      // In this simplified version, we don't actually save
      // but we show a success message and return to the list
      showMessage('Success', `Song "${title}" has been saved!`);
      hideEditor();
    }
    
    // Show modal with message
    function showMessage(title, message) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-message').textContent = message;
      document.getElementById('message-modal').style.display = 'flex';
    }
    
    // Hide modal
    function hideModal() {
      document.getElementById('message-modal').style.display = 'none';
    }
    
    // Generate markdown for the current form state
    function generateMarkdown() {
      // Get values from form
      const title = document.getElementById('title').value.trim();
      const slug = document.getElementById('slug').value.trim();
      const date = document.getElementById('date').value;
      const duration = document.getElementById('duration').value.trim();
      
      if (!title || !slug) {
        showMessage('Error', 'Title and slug are required to generate markdown.');
        return;
      }
      
      // Build the markdown with YAML frontmatter
      let markdown = '---\n';
      markdown += `title: ${title}\n`;
      markdown += `slug: ${slug}\n`;
      
      if (date) markdown += `date: ${date}\n`;
      if (duration) markdown += `duration: ${duration}\n`;
      
      const status = document.getElementById('status').value;
      markdown += `status: ${status}\n`;
      
      // Add media details
      markdown += '\nmedia:\n';
      
      if (document.getElementById('has_mp3').checked) {
        const mp3Url = document.getElementById('mp3_url').value;
        if (mp3Url) {
          markdown += '  - type: mp3\n';
          markdown += `    url: ${mp3Url}\n`;
        }
      }
      
      if (document.getElementById('has_artwork').checked) {
        const artworkUrl = document.getElementById('artwork_url').value;
        if (artworkUrl) {
          markdown += '  - type: artwork\n';
          markdown += `    url: ${artworkUrl}\n`;
          
          const altText = document.getElementById('artwork_alt_text').value;
          if (altText) markdown += `    alt: "${altText}"\n`;
          
          const artworkTitle = document.getElementById('artwork_title').value;
          if (artworkTitle) markdown += `    title: "${artworkTitle}"\n`;
        }
      }
      
      // Add credits if provided
      const composers = document.getElementById('composers').value.trim();
      const performers = document.getElementById('performers').value.trim();
      
      if (composers || performers) {
        markdown += '\ncredits:\n';
        
        if (composers) {
          markdown += '  composers:\n';
          composers.split('\n').forEach(composer => {
            if (composer.trim()) markdown += `    - ${composer.trim()}\n`;
          });
        }
        
        if (performers) {
          markdown += '  performers:\n';
          performers.split('\n').forEach(performer => {
            if (performer.trim()) markdown += `    - ${performer.trim()}\n`;
          });
        }
      }
      
      // Add tags if provided
      const tags = document.getElementById('tags').value.trim();
      if (tags) {
        markdown += '\ntags:\n';
        tags.split(',').forEach(tag => {
          if (tag.trim()) markdown += `  - ${tag.trim()}\n`;
        });
      }
      
      // Add origin info
      const location = document.getElementById('location').value.trim();
      const season = document.getElementById('season').value;
      const moonPhase = document.getElementById('moon_phase').value;
      
      if (location || season || moonPhase) {
        markdown += '\norigin:\n';
        
        if (location) markdown += `  location: "${location}"\n`;
        
        if (season || moonPhase) {
          markdown += '  celestial:\n';
          if (season) markdown += `    season: "${season}"\n`;
          if (moonPhase) markdown += `    moonPhase: "${moonPhase}"\n`;
        }
      }
      
      // Add notes if provided
      const publicNotes = document.getElementById('public_notes').value.trim();
      if (publicNotes) {
        markdown += `\nnotes: |\n  ${publicNotes.replace(/\n/g, '\n  ')}\n`;
      }
      
      // End frontmatter
      markdown += '---\n\n';
      
      // Add lyrics as content
      const lyrics = document.getElementById('lyrics').value.trim();
      if (lyrics) {
        markdown += lyrics;
      }
      
      // Display the markdown
      const markdownOutput = document.getElementById('markdown-output');
      markdownOutput.textContent = markdown;
      markdownOutput.style.display = 'block';
      
      // Hide editor content but leave the page in editor mode
      document.getElementById('song-editor').style.display = 'none';
      document.getElementById('song-list').style.display = 'none';
      
      // Add action buttons for the markdown
      const buttonGroup = document.createElement('div');
      buttonGroup.className = 'button-group';
      buttonGroup.style.marginBottom = '20px';
      
      const backButton = document.createElement('button');
      backButton.textContent = 'Back to Editor';
      backButton.onclick = function() {
        document.getElementById('song-editor').style.display = 'block';
        document.getElementById('markdown-output').style.display = 'none';
        markdownOutput.parentNode.removeChild(buttonGroup);
      };
      
      buttonGroup.appendChild(backButton);
      markdownOutput.parentNode.insertBefore(buttonGroup, markdownOutput);
    }
